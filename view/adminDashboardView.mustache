<section class="w3-light-grey d-flex justify-content-center align-items-center min-vh-100">
    <div class="container my-5 bg-white rounded-4 shadow-lg p-5">

        {{#usuario}}
            <!-- Título -->
            <div class="bg-light p-4 rounded-4 mb-5 shadow-sm d-flex flex-column flex-md-row align-items-center justify-content-around gap-4">
                <div class="d-flex align-items-center gap-3">
                    <i class="fas fa-cogs fa-2x"></i>
                    <h2 class="fw-bold mb-0">Panel de Administrador</h2>
                </div>
                <div class="d-flex flex-column flex-md-row align-items-center gap-5">
                    <div class="text-center text-md-end">
                        <h4 class="fw-semibold mb-1">{{nombre_completo}}</h4>
                        <p class="mb-1 text-muted">{{mail}}</p>
                        <small class="text-secondary">{{ciudad}}, {{pais}}</small>
                    </div>
                    <div>
                        {{#foto_perfil}}
                            <img src="/QuizGame/public/uploads/{{foto_perfil}}" alt="Foto de perfil"
                                 class="rounded-circle img-fluid border border-2"
                                 style="width: 128px; height: 128px; object-fit: cover;">
                        {{/foto_perfil}}
                        {{^foto_perfil}}
                            <i class="fa fa-user-circle text-secondary" style="font-size: 128px;"></i>
                        {{/foto_perfil}}
                    </div>
                </div>
            </div>
        {{/usuario}}

        <!-- Gráficos -->
        <div class="row text-center gy-4">
            <form method="get" class="text-center mb-4">
                <label for="filtro_fecha" class="me-2 fw-semibold">Filtrar por:</label>
                <select name="filtro_fecha" id="filtro_fecha" onchange="this.form.submit()"
                        class="form-select d-inline w-auto">
                    <option value="dia" {{#filtroDia}}selected{{/filtroDia}}>Hoy</option>
                    <option value="semana" {{#filtroSemana}}selected{{/filtroSemana}}>Últimos 7 días</option>
                    <option value="mes" {{#filtroMes}}selected{{/filtroMes}}>Último mes</option>
                    <option value="año" {{#filtroAño}}selected{{/filtroAño}}>Último año</option>
                    <option value="todos" {{#filtroTodos}}selected{{/filtroTodos}}>Todos</option>
                </select>
            </form>


            <div class="col-md-4">
                <div class="bg-white border rounded-4 shadow-sm p-3">
                    <h5 class="fw-bold">Jugadores por País</h5>
                    <img src="/QuizGame/graph/usuariosPorPais?filtro_fecha={{filtroSeleccionado}}" class="img-fluid rounded">
                </div>
            </div>
            <div class="col-md-4">
                <div class="bg-white border rounded-4 shadow-sm p-3">
                    <h5 class="fw-bold">Jugadores por Sexo</h5>
                    <img src="/QuizGame/graph/usuariosPorSexo?filtro_fecha={{filtroSeleccionado}}" class="img-fluid rounded">
                </div>
            </div>
            <div class="col-md-4">
                <div class="bg-white border rounded-4 shadow-sm p-3">
                    <h5 class="fw-bold">Jugadores por Grupo Etario</h5>
                    <img src="/QuizGame/graph/usuariosPorGrupo?filtro_fecha={{filtroSeleccionado}}" class="img-fluid rounded">
                </div>
            </div>
        </div>

        <hr class="my-5">

        <div class="mt-5">
            <h3 class="fw-bold text-center mb-4">Desempeño de Usuarios</h3>

            <div class="table-responsive">
                <table class="table table-striped table-hover rounded-4 overflow-hidden shadow-sm">
                    <thead class="table-dark">
                    <tr>
                        <th scope="col">Usuario</th>
                        <th scope="col" class="text-center">Respuestas Correctas</th>
                        <th scope="col" class="text-center">Respuestas Totales</th>
                        <th scope="col" class="text-center">Porcentaje de Aciertos</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{#desempenoUsuarios}}
                        {{#.}}
                            <tr>
                                <td>{{nombre_usuario}}</td>
                                <td class="text-center">{{respuestas_correctas}}</td>
                                <td class="text-center">{{total_respuestas}}</td>
                                <td class="text-center">{{porcentaje_aciertos}}%</td>
                            </tr>
                        {{/.}}
                    {{/desempenoUsuarios}}
                    </tbody>
                </table>
            </div>

            {{^desempenoUsuarios}}
                <div class="alert alert-info text-center" role="alert">
                    No hay datos de desempeño para mostrar con el filtro seleccionado.
                </div>
            {{/desempenoUsuarios}}
        </div>

        <div class="text-center mt-5 d-flex flex-column flex-md-row justify-content-center gap-3">
            <a href="/QuizGame/admin/exportarPDF?filtro_fecha={{filtroSeleccionado}}" target="_blank"
            class="btn btn-outline-dark px-4 py-3 rounded-4 shadow-sm fs-5 flex-grow-1">
            <i class="fas fa-file-pdf fa-2x me-2"></i> Exportar Gráficos PDF
            </a>
            <a href="/QuizGame/admin/exportarPDFDesempeno?filtro_fecha={{filtroSeleccionado}}" target="_blank"
            class="btn btn-outline-dark px-4 py-3 rounded-4 shadow-sm fs-5 flex-grow-1">
            <i class="fas fa-file-pdf fa-2x me-2"></i> Exportar Desempeño PDF
            </a>
        </div>

    </div>
</section>
